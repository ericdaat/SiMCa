{% extends 'base.html' %}

{% block body %}

<!-- Parameters form -->

<h2 class="my-3 border-bottom">Parameters</h2>

    <form action="{{ url_for('home.index') }}" method="get">

        <div class="form-row">
            <div class="col">

                <div class="form-group">
                    <div class="form-row">
                        <div class="col">
                            <label>Number of users</label>
                            <input class="form-control"
                                   name="n_users"
                                   value="{{request.args.get('n_users', 1000)}}">
                        </div>

                        <div class="col">
                            <label>Number of Points Of Interest (POIs)</label>
                            <input class="form-control"
                                   name="n_pois"
                                value="{{request.args.get('n_pois', 3)}}">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Number of generated clusters</label>
                    <input class="form-control"
                            name="n_centers"
                            value="{{request.args.get('n_centers', 3)}}">
                </div>

                <div class="form-group">
                    <div class="form-row">
                        <div class="col">
                            <label>Distance weight</label>
                            <input class="form-control"
                                    name="distance_weight"
                                    value="{{request.args.get('distance_weight', 0)}}">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="generate" value="true">
                        <label class="form-check-label">
                            Generate a new dataset
                        </label>
                    </div>
                </div>

            </div>

            <div class="col">
                <div class="form-group">
                    <div class="form-row">
                        <div class="col">
                            <label>Users embeddings</label>
                            <select class="custom-select" name="users_embeddings">
                                {% if request.args.get('users_embeddings') == 'learn' %}
                                    <option selected value="learn">Learn</option>
                                    <option value="pre-trained">Pre-trained</option>
                                {% else %}
                                    <option selected value="pre-trained">Pre-trained</option>
                                    <option value="learn">Learn</option>
                                {% endif %}
                            </select>
                        </div>

                        <div class="col">
                            <label>Assignation</label>
                            <select class="custom-select" name="assign">
                                {% if request.args.get('assign') == 'sample' %}
                                    <option selected value="sample">Sample</option>
                                    <option value="lap">Lap</option>
                                    <option value="argmax">Argmax</option>
                                {% elif request.args.get('assign') == 'argmax' %}
                                    <option selected value="argmax">Argmax</option>
                                    <option value="lap">Lap</option>
                                    <option value="sample">Sample</option>
                                {% else %}
                                    <option selected value="lap">Lap</option>
                                    <option value="argmax">Argmax</option>
                                    <option value="sample">Sample</option>
                                {% endif %}
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group">

                    <div class="form-row">
                        <div class="col">
                            <label>Number of epochs</label>
                            <input class="form-control"
                                    name="n_epochs"
                                    value="{{request.args.get('n_epochs', 200)}}">
                        </div>

                        <div class="col">
                            <label>Learning rate</label>
                            <input class="form-control"
                                    name="lr"
                                    value="{{request.args.get('lr', 0.01)}}">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="form-row">
                        <div class="col">
                            <label>Alpha</label>
                            <input class="form-control"
                                    name="alpha"
                                    value="{{request.args.get('alpha', 0)}}">
                        </div>

                        <div class="col">
                            <label>Epsilon</label>
                            <input class="form-control"
                                    name="epsilon"
                                    value="{{request.args.get('epsilon', 0.1)}}">
                        </div>

                        <div class="col">
                            <label>Sinkhorn iterations</label>
                            <input class="form-control"
                                    name="n_iter"
                                    value="{{request.args.get('n_iter', 10)}}">
                        </div>
                    </div>

                </div>

            </div>
        </div>

        <div class="form-row">
            <div class="col">
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Train the model</button>
                </div>
            </div>
        </div>

    </form>

<!-- Training plots -->

<h2 class="my-3 border-bottom">Model</h2>
    <p>Points of interest (POIs): </p>
    <div class="col">
        <div class="row">
            {% for color in pois_colors %}
                <div class="text-center mx-1" style="width:50; height:25px; background:{{color}};">POI {{loop.index}}</div>
            {% endfor %}
        </div>
    </div>

    <div class="text-center">
        <div class="my-5">
            <img src='data:image/png;base64, {{fig3_data}}'/>
            <h5 class="mt-3">Model training stats</h5>
        </div>

        <div class="my-5">
            <img src='data:image/png;base64, {{fig2_data}}'/>
            <h5 class="mt-3">Model predictions</h5>
        </div>

        <div class="my-5">
            <img src='data:image/png;base64, {{fig1_data}}'/>
            <h5 class="mt-3">Ground truth</h5>
        </div>
    </div>

{% endblock %}
